"use strict";angular.module("prometheusApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngTouch","pascalprecht.translate","restangular","ui.slider","infinite-scroll","720kb.socialshare","angular-loading-bar","toastr","ui.select","ngStorage","ui.bootstrap","textAngular"]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"/translations/",suffix:".json"}),a.preferredLanguage("venezuela"),a.useSanitizeValueStrategy("escape")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/aboutUs",{templateUrl:"views/about.html",controller:"AboutUsCtrl"}).when("/internationalProjects",{templateUrl:"views/internationalProject.html",controller:"InternationalProjectsCtrl"}).when("/contactUs",{templateUrl:"views/contact.html",controller:"ContactUsCtrl"}).when("/property/:propertyType/:propertyId",{templateUrl:"views/property.html",controller:"PropertyCtrl"}).when("/news",{templateUrl:"views/newsRead.html",controller:"NewsReadCtrl"}).when("/admin/login",{templateUrl:"views/admin/login.html",controller:"LoginCtrl"}).when("/admin/news",{templateUrl:"views/admin/news.html",controller:"NewsCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.defaults.headers.common.Accept="application/json, text/javascript",a.defaults.headers.common["Content-Type"]="application/json; charset=utf-8",a.defaults.withCredentials=!0,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).factory("authHttpInterceptor",["$q","$location","$sessionStorage",function(a,b,c){return{responseError:function(c){return(void 0!=c.data&&0===c.data.code||401===c.status||403===c.status)&&b.path("/admin/login"),a.reject(c)},request:function(a){return console.log("INTERCEPTOR",c.session),c.session&&c.session.id&&(a.headers.Authorization=c.session.id),a}}}]).config(["$httpProvider",function(a){a.interceptors.push("authHttpInterceptor")}]),angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",2e3),angular.module("prometheusApp").controller("HomeCtrl",["myConfig","$translate","$scope","restangularInstance","resources","$http","toastr","$sessionStorage",function(a,b,c,d,e,f,g,h){c.reddit=function(){this.items=[],this.busy=!1,this.after=""},c.orderPrices=[{name:"Menor precio",value:!1},{name:"Mayor precio",value:!0}],c.orderMts=[{name:"Menor mts2",value:!1},{name:"Mayor mts2",value:!0}],c.orderBaths=[{name:"Menor cantidad",value:!1},{name:"Mayor cantidad",value:!0}],c.orderRooms=[{name:"Menor cantidad",value:!1},{name:"Mayor cantidad",value:!0}];var i=0;c.storage=h,c.countries=[],c.propertyTypes=[],c.topProperties=[],c.filteredStates=[],c.filteredCities=[],c.filteredResidentialAreas=[],c.searchProperties=[],c.dataAvailable=!0,c.$on("COUNTRY_CHANGED",function(a,d){b.use(d.replace(" ","").toLowerCase()).then(function(){b("homeRentOperation").then(function(a){c.operationTypes=[{name:"Venta"},{name:a}]})})}),d.all(e.properties).all(e.trending).customGET().then(function(a){c.topProperties=_.filter(a.data.plain(),function(a){return null!=a})})["catch"](function(a){g.error("No existen propiedades populares")}),d.all(e.propertiesTypes).getList().then(function(a){c.propertyTypes=a.data.plain()})["catch"](function(a){g.error("Ocurrió un error al cargar los tipos de propiedades"),console.log(a)}),d.all(e.countries).getList().then(function(b){c.countries=b.data.plain();var d=_.remove(c.countries,function(b){return b.name===a.country});c.countries.splice(0,0,d[0]),c.storage.selectedCountry||(c.storage.selectedCountry=c.countries[0]),c.storage.selectedPropertyType||c.selectCountry(c.storage.selectedCountry,!1),c.$emit("COUNTRY_CHANGED",c.storage.selectedCountry.name)})["catch"](function(a){g.error("Ocurrió un error al cargar los paises disponibles"),console.log(a)}),c.sortByPrice=function(a,b,d){c.orderProp="price",c.isReverse=a.value},c.sortByBaths=function(a,b,d){c.orderProp="bathrooms",c.isReverse=a.value},c.sortByRooms=function(a,b,d){c.orderProp="bedrooms",c.isReverse=a.value},c.sortByMts=function(a,b,d){c.isReverse=a.value,"E"==c.storage.selectedPropertyType.className?c.orderProp="squareLand":c.orderProp="squareConstruction"},c.selectCountry=function(a,b,d){c.storage.selectedCountry=a,c.storage.filteredPropertyTypes=_.filter(c.propertyTypes,function(a){return a.country==c.storage.selectedCountry.name}),c.storage.selectedPropertyType=c.storage.filteredPropertyTypes[0],d&&(c.storage.selectedState=null,c.storage.selectedCity=null,c.storage.selectedResidentialArea=null),c.$emit("COUNTRY_CHANGED",a.name)},c.stateSelected=function(a,b){c.storage.selectedState=a,c.storage.selectedCity=a.city[0]},c.citySelected=function(a,b){c.storage.selectedCity=a,c.storage.selectedResidentialArea=a.residentialAreas[0]},c.residentialAreaSelected=function(a,b){c.storage.selectedResidentialArea=a},c.propertyTypeSelected=function(a,b){c.storage.selectedPropertyType=a},c.operationTypeSelected=function(a,b){c.storage.selectedOperationType=a},c.search=function(a){if(c.reddit.busy=!0,!c.storage.selectedCountry&&!c.internalId)return c.reddit.busy=!1,g.error("Por favor seleccione un País");if(c.storage.selectedCountry&&!c.storage.selectedPropertyType&&!c.internalId)return c.reddit.busy=!1,g.error("Por favor seleccione un tipo de propiedad");a||(c.searchProperties=[],i=0,c.reddit.busy=!1);var b={limit:12,offset:i,where:{}};void 0!=c.internalId&&0!=c.internalId.length?angular.extend(b.where,{listingId:c.internalId}):(c.storage.selectedState&&c.storage.selectedState.name&&angular.extend(b.where,{state:c.storage.selectedState.name}),c.storage.selectedOperationType&&c.storage.selectedOperationType.name&&angular.extend(b.where,{operationType:c.storage.selectedOperationType.name}),c.storage.selectedCity&&c.storage.selectedCity.name&&angular.extend(b.where,{city:c.storage.selectedCity.name}),c.storage.selectedResidentialArea&&c.storage.selectedResidentialArea.name&&angular.extend(b.where,{residentialArea:c.storage.selectedResidentialArea.name}),c.storage.selectedPropertyType&&c.storage.selectedPropertyType.className&&angular.extend(b.where,{propertyType:c.storage.selectedPropertyType.className}),c.minPrice&&0!=c.minPrice&&c.maxPrice&&0!=c.maxPrice?angular.extend(b.where,{price:{between:[c.minPrice,c.maxPrice]}}):b.where.price||!c.minPrice&&!c.maxPrice||(angular.extend(b.where,{price:{}}),c.minPrice&&0!=c.minPrice&&angular.extend(b.where.price,{gte:c.minPrice}),c.maxPrice&&0!=c.maxPrice&&angular.extend(b.where.price,{lte:c.maxPrice})),c.minBedrooms&&0!=c.minBedroom&&c.maxBedrooms&&0!=c.maxBedrooms?angular.extend(b.where,{bedrooms:{between:[c.minBedrooms,c.maxBedrooms]}}):b.where.bedrooms||!c.minBedrooms&&!c.maxBedrooms||(angular.extend(b.where,{bedrooms:{}}),c.minBedrooms&&0!=c.minBedrooms&&angular.extend(b.where.bedrooms,{gte:c.minBedrooms}),c.maxBedrooms&&0!=c.maxBedrooms&&angular.extend(b.where.bedrooms,{lte:c.maxBedrooms})),c.minBath&&0!=c.minBath&&c.maxBath&&0!=c.maxBath?angular.extend(b.where,{bathrooms:{between:[c.minBath,c.maxBath]}}):b.where.bathrooms||!c.minBath&&!c.maxBath||(angular.extend(b.where,{bathrooms:{}}),c.minBath&&0!=c.minBath&&angular.extend(b.where.bathrooms,{gte:c.minBath}),c.maxBath&&0!=c.maxBath&&angular.extend(b.where.bathrooms,{lte:c.maxBath})),"E"==c.storage.selectedPropertyType.className?c.minMts&&0!=c.minMts&&c.maxMts&&0!=c.maxMts?angular.extend(b.where,{squareLand:{between:[c.minMts,c.maxMts]}}):b.where.squareLand||!c.minMts&&!c.maxMts||(angular.extend(b.where,{squareLand:{}}),c.minMts&&0!=c.minMts&&angular.extend(b.where.squareLand,{gte:c.minMts}),c.maxMts&&0!=c.maxMts&&angular.extend(b.where.squareLand,{lte:c.maxMts})):c.minMts&&0!=c.minMts&&c.maxMts&&0!=c.maxMts?angular.extend(b.where,{squareConstruction:{between:[c.minMts,c.maxMts]}}):b.where.squareConstruction||!c.minMts&&!c.maxMts||(angular.extend(b.where,{squareConstruction:{}}),c.minMts&&0!=c.minMts&&angular.extend(b.where.squareConstruction,{gte:c.minMts}),c.maxMts&&0!=c.maxMts&&angular.extend(b.where.squareConstruction,{lte:c.maxMts}))),d.all(e.properties).getList({filter:b}).then(function(b){c.searchProperties=c.searchProperties.concat(b.data.plain()),c.searchProperties=_.uniq(c.searchProperties,!1,function(a){return a.internalId}),i+=b.data.length,c.dataAvailable=b.data.length>0,c.reddit.busy=0==b.data.length,!b.data.length>0&&(a||g.error("No existen propiedades disponibles."))})["catch"](function(a){console.log(a),c.reddit.busy=!1,g.error("Ocurrió un error, por favor, intente de nuevo "+a.message)})},c.scrollAlert=function(a){console.log("bottom scroll")}}]),angular.module("prometheusApp").controller("AboutUsCtrl",["$scope",function(a){a.advantages=[{title:"Asesoría y Gestión Inmobiliaria",content:"Acompañamiento legal y financiero para brindar seguridad en las negociaciones y tramites a nuestros clientes."},{title:"Intermediación Inmobiliaria",content:"Alquiler, compra y venta de apartamentos, casas, townhouses, anexos, inmuebles comerciales, industriales tanto en obras terminadas como en construcción o proyecto."},{title:"Promoción Inmobiliaria",content:"Proporcionamos a nuestros clientes un servicio de mercadeo y publicidad de sus inmuebles a nivel nacional e internacional."},{title:"Reubicación Nacional e Internacional",content:"Contamos con el servicio de asesoramiento inmobiliario para reubicar a nuestros clientes, apoyados en nuestras diferentes oficinas del país."},{title:"Negocios y Empresas",content:"Las solicitudes para vender o comprar empresas en marcha son manejadas con los procedimientos de ultima tecnología. Esta, junto con la formación continua de los profesionales logra que los clientes vendan o adquieran las empresas industriales, comerciales o de servicios que se adecuen a sus necesidades."}],a.staff=[{name:"Pedro Perez",img:"../images/a3.jpg",description:"Constituye una de estas Franquicias Personales y se identifica como uno de nuestros tantos baluartes dentro de esta modalidad, está en la capacidad de brindarle un óptimo servicio especialmente: la oferta y demanda en la venta, compra o alquiler de apartamentos, casas, quintas, locales, oficinas, galpones, terrenos y demás propiedades en toda Venezuela, ofreciendo un trato personalizado para la ejecución satisfactoria de todo tipo de negociaciones inmobiliarias en el país."}]}]),angular.module("prometheusApp").controller("LoginCtrl",["$rootScope","$scope","resources","restangularInstance","toastr","$sessionStorage","$q","$location",function(a,b,c,d,e,f,g,h){delete f.session,b.email,b.password,b.login=function(a,g){a&&g&&d.one(c.franchisees).all(c.login).post({email:b.email,password:b.password}).then(function(a){f.session=a.data.plain(),h.path("/admin/news")})["catch"](function(a){var b;b=401===a.status?"Usuario o contraseña inválidos.":a.message,e.error(b)})}}]),angular.module("prometheusApp").controller("HeaderCtrl",["$scope","$location",function(a,b){var c=b.path();a.show=-1===c.indexOf("admin")}]),angular.module("prometheusApp").controller("ContactUsCtrl",["$scope","$http","myConfig","restangularInstance","resources","toastr",function(a,b,c,d,e,f){a.realistName=c.realistName,a.realisttRif=c.realistRif,a.realistDirection=c.realistDirection,a.realistOfficePhone=c.realistOfficePhone,a.realistCelphone=c.realistCelphone,a.sendEmail=function(){a.email.realistEmail=c.realistEmail,d.one(e.email).post(e.send,{email:a.email}).then(function(a){a.data.sentEmail?f.info("Gracias por contactarnos!"):f.error("Sucedió un error al enviar el correo, intentelo nuevamente por favor.")})["catch"](function(a){f.error("Sucedió un error al enviar el correo, intentelo nuevamente por favor.")})}}]),angular.module("prometheusApp").controller("PropertyCtrl",["$scope","$routeParams","myConfig","restangularInstance","resources","$location","toastr","$http","$window",function(a,b,c,d,e,f,g,h,i){a.path=f.absUrl();var j=b.propertyId;a.propertyType=b.propertyType,"H"!==b.propertyType?d.one(e.properties,j).one(e.visit).post().then(function(b){a.property=b.data.views,a.email.message="Property id: "+b.data.views.internalId})["catch"](function(a){g.error("No existe una propiedad con el id: "+j)}):d.one(e.internationalProjects,j).get().then(function(b){console.log(b.data),a.property=b.data,a.email.message="Property id: "+b.data.internalId})["catch"](function(a){g.error("No existe una propiedad con el id: "+j)}),a.email={},a.sendEmail=function(){a.email.realistEmail=c.realistEmail,d.one(e.email).post(e.send,{email:a.email}).then(function(a){a.data.sentEmail?g.info("Gracias por contactarnos!"):g.error("Sucedió un error al enviar el correo, intentelo nuevamente por favor.")})["catch"](function(a){g.error("Sucedió un error al enviar el correo, intentelo nuevamente por favor.")})}}]),angular.module("prometheusApp").controller("InternationalProjectsCtrl",["myConfig","$scope","restangularInstance","resources","$http","toastr","$sessionStorage",function(a,b,c,d,e,f,g){b.reddit=function(){this.items=[],this.busy=!1,this.after=""},b.orderPrices=[{name:"Menor precio",value:!1},{name:"Mayor precio",value:!0}],b.orderMts=[{name:"Menor mts2",value:!1},{name:"Mayor mts2",value:!0}],b.orderBaths=[{name:"Menor cantidad",value:!1},{name:"Mayor cantidad",value:!0}],b.orderRooms=[{name:"Menor cantidad",value:!1},{name:"Mayor cantidad",value:!0}];var h=0;b.storage=g,b.storage.internationalProperty="H",b.filteredStates=[],b.filteredCities=[],b.filteredResidentialAreas=[],b.searchProperties=[],b.dataAvailable=!0,b.operationTypes=a.operationType,c.all(d.countries).getList().then(function(a){b.countries=[{name:"Estados Unidos",states:[]}].concat(a.data.plain())})["catch"](function(a){f.error("Ocurrió un error al cargar los paises disponibles"),console.log(a)}),b.sortByPrice=function(a,c,d){b.orderProp="price",b.isReverse=a.value},b.sortByBaths=function(a,c,d){b.orderProp="bathrooms",b.isReverse=a.value},b.sortByRooms=function(a,c,d){b.orderProp="bedrooms",b.isReverse=a.value},b.sortByMts=function(a,c,d){b.isReverse=a.value,b.orderProp="squareLand"},b.selectPropertyType=function(a,c,d){b.storage.internationalCountry=a,d&&(b.storage.internationalState={},b.storage.internationalCity={},b.storage.internationalResidentialArea={})},b.stateSelected=function(a,c){b.storage.internationalState=a},b.citySelected=function(a,c){b.storage.internationalCity=a},b.residentialAreaSelected=function(a,c){b.storage.internationalResidentialArea=a},b.operationTypeSelected=function(a,c){b.storage.internationalOperationType=a},b.search=function(a){b.reddit.busy=!0,a||(b.searchProperties=[],h=0,b.reddit.busy=!1);var e={limit:12,offset:h,where:{propertyType:b.storage.internationalProperty}};void 0!=b.internalId&&0!=b.internalId.length?angular.extend(e.where,{listingId:b.internalId}):(b.storage.internationalCountry&&b.storage.internationalCountry.name&&angular.extend(e.where,{country:b.storage.internationalCountry.name}),b.minPrice&&0!=b.minPrice&&b.maxPrice&&0!=b.maxPrice?angular.extend(e.where,{price:{between:[b.minPrice,b.maxPrice]}}):e.where.price||!b.minPrice&&!b.maxPrice||(angular.extend(e.where,{price:{}}),b.minPrice&&0!=b.minPrice&&angular.extend(e.where.price,{gte:b.minPrice}),b.maxPrice&&0!=b.maxPrice&&angular.extend(e.where.price,{lte:b.maxPrice})),b.minBedrooms&&0!=b.minBedroom&&b.maxBedrooms&&0!=b.maxBedrooms?angular.extend(e.where,{bedrooms:{between:[b.minBedrooms,b.maxBedrooms]}}):e.where.bedrooms||!b.minBedrooms&&!b.maxBedrooms||(angular.extend(e.where,{bedrooms:{}}),b.minBedrooms&&0!=b.minBedrooms&&angular.extend(e.where.bedrooms,{gte:b.minBedrooms}),b.maxBedrooms&&0!=b.maxBedrooms&&angular.extend(e.where.bedrooms,{lte:b.maxBedrooms})),b.minBath&&0!=b.minBath&&b.maxBath&&0!=b.maxBath?angular.extend(e.where,{bathrooms:{between:[b.minBath,b.maxBath]}}):e.where.bathrooms||!b.minBath&&!b.maxBath||(angular.extend(e.where,{bathrooms:{}}),b.minBath&&0!=b.minBath&&angular.extend(e.where.bathrooms,{gte:b.minBath}),b.maxBath&&0!=b.maxBath&&angular.extend(e.where.bathrooms,{lte:b.maxBath})),b.minMts&&0!=b.minMts&&b.maxMts&&0!=b.maxMts?angular.extend(e.where,{squareLand:{between:[b.minMts,b.maxMts]}}):e.where.squareLand||!b.minMts&&!b.maxMts||(angular.extend(e.where,{squareLand:{}}),b.minMts&&0!=b.minMts&&angular.extend(e.where.squareLand,{gte:b.minMts}),b.maxMts&&0!=b.maxMts&&angular.extend(e.where.squareLand,{lte:b.maxMts}))),c.all(d.internationalProjects).getList({filter:e}).then(function(c){b.searchProperties=b.searchProperties.concat(c.data),b.searchProperties=_.uniq(b.searchProperties,!1,function(a){return a.internalId}),h+=c.data.length,b.dataAvailable=c.data.length>0,b.reddit.busy=0==c.data.length,!c.data.length>0&&(a||f.error("No existen propiedades disponibles."))})["catch"](function(a){console.log(a),f.error(a)})},b.scrollAlert=function(a){console.log("bottom scroll")}}]),angular.module("prometheusApp").controller("NewsReadCtrl",["$scope","myConfig","restangularInstance","resources","$location","toastr",function(a,b,c,d,e,f){console.log(),a.news=[],c.one(d.franchisees,b.userId).all(d.news).getList().then(function(b){a.news=b.data.plain(),console.log("NOTI",a.news)})["catch"](function(a){f.error("No existe una propiedad con el id: "+propertyId)})}]),angular.module("prometheusApp").value("myConfig",{country:"Venezuela",realistEmail:"mariana.salcedo@dnd1.com",realistName:"Pedro Perez",realistRif:"J-564321456-7.",realistDirection:"Av. San Juan Bosco, entre la primera y segunda trasversal, Edificio For You, Piso 8, Oficina 8-A, Altamira, Municipio Chacao.Caracas  Venezuela",realistOfficePhone:"02128789922",realistCelphone:"04121234567",operationType:[{name:"Alquiler"},{name:"Venta"}],description:"Constituye una de estas Franquicias Personales y se identifica como uno de nuestros tantos baluartes dentro de esta modalidad, está en la capacidad de brindarle un óptimo servicio especialmente: la oferta y demanda en la venta, compra o alquiler de apartamentos, casas, quintas, locales, oficinas, galpones, terrenos y demás propiedades en toda Venezuela, ofreciendo un trato personalizado para la ejecución satisfactoria de todo tipo de negociaciones inmobiliarias en el país.",domain:"marysalsita.com",template:"template1",lat:"asdfasdf",log:"asdfd",userId:"55d24e15983b95b4707f110b"}),angular.module("prometheusApp").value("apiBaseUrl","http://200.58.102.106:3001/api").factory("resources",[function(){return{countries:"countries",propertiesTypes:"propertiesTypes",properties:"properties",internationalProjects:"internationalProjects",visit:"visit",email:"emails",send:"sendEmail",trending:"trending",filter:"filter",franchisees:"franchisees",news:"news",login:"login",image:"image"}}]).factory("restangularInstance",["Restangular","apiBaseUrl",function(a,b){return a.setBaseUrl(b),a.setFullResponse(!0),a}]),angular.module("prometheusApp").filter("currencyAbbv",function(){return function(a){return"Bolivares Fuertes"==a?"BsF.":"Bolivares"==a?"Bs.":"US Dollar"==a?"$":"Pesos"==a?"$":"Unidades de Fomento"==a?"Uf.":"Dolar"==a?"$":"Colones)"==a?" ₵":a}}),angular.module("prometheusApp").directive("dndMarkActive",["$rootScope","$location",function(a,b){return{restrict:"A",link:function(a,c,d){var e=function(){return b.path()};return a.$watch(e,function(a,b){var f=d.dndMarkActive;e()==f?c.addClass("active"):c.removeClass("active")})}}}]),angular.module("prometheusApp").controller("NewsCtrl",["myConfig","$scope","restangularInstance","resources","$http","toastr","$sessionStorage","$modal",function(a,b,c,d,e,f,g,h){b.franchiseeNews=[],b.loadNews=function(){c.one(d.franchisees,g.session.userId).all(d.news).getList().then(function(a){console.log("Noticias",a.data.plain()),b.franchiseeNews=a.data.plain()})},b.loadNews(),b.openModal=function(a){var c=h.open({animation:b.animationsEnabled,templateUrl:"newsModal.html",controller:"NewsModalCtrl",size:"lg",resolve:{news:function(){return a}}});c.result.then(function(a){b.loadNews()},function(){})},b.newNews=function(){b.openModal({title:"",content:""})},b.removeNews=function(a,e){c.one(d.news,a.id).remove().then(function(a){console.log(a),b.franchiseeNews.slice(1,e)})["finally"](function(){b.loadNews()})}}]).controller("NewsModalCtrl",["$scope","$modalInstance","news","resources","restangularInstance","$sessionStorage","toastr",function(a,b,c,d,e,f,g){a.news=c,console.log("id de la noticia",c.id),a.ok=function(c){console.log("id de la noticia",c.id,c);var h=null;h=c.id?e.one(d.franchisees,f.session.userId).one(d.news,c.id).customPUT(c):e.one(d.franchisees,f.session.userId).all(d.news).post(c),h.then(function(b){console.log("respuesta",b.data.plain()),a.news=b.data.plain()})["finally"](function(){b.close(a.modal)})["catch"](function(a){g.error("Ocurrió un error guardando la noticia.")})}}]);